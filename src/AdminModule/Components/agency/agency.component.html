<!-- Navbar -->
<div class="background">

<div class="navbar">
    <div class="logo">
        Admin Dashboard
    </div>
    <div class="nav-links">
        <a href="agency" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Agencies</a>
        <a href="bus" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;" >Buses</a>
        <a href="admin-customer" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Customers</a>
        <a href="drivers" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Drivers</a>
        <a href="payments" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Payment</a>
        <a href="reviews" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Reviews</a>
        <a href="routes" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Routes</a>
        <a href="#trips" style="color: rgb(243, 237, 237); text-decoration: none; padding: 10px 15px;">Trips</a>
    <button class="logout-btn" (click)="logout()">Logout</button>
</div>
</div>

<!-- Content Area -->
<div class="content-container">
    <h1>Manage Agencies</h1>

    <!-- Search Dropdown and Input Fields -->
    <div class="search-container">
        <label for="searchType">Search By:</label>
        <select id="searchType" [(ngModel)]="searchType">
            <option value="id">ID</option>
            <option value="name">Name</option>
            <option value="contactPerson">Contact Person Name</option>
        </select>

        <input *ngIf="searchType === 'name'" type="text" placeholder="Enter Agency Name" [(ngModel)]="searchAgencyName"/>
        <input *ngIf="searchType === 'id'" type="number" placeholder="Enter Agency ID" [(ngModel)]="searchAgencyId"/>
        <input *ngIf="searchType === 'contactPerson'" type="text" placeholder="Enter Contact Person Name" [(ngModel)]="searchContactPersonName"/>

        <button class="search-btn" (click)="searchAgency()">Search</button>

        <div *ngIf="searchAgencyName && searchAgencyName.length === 0" class="error">
            Please enter a valid Agency Name.
        </div>
        <div *ngIf="searchAgencyId && searchAgencyId <= 0" class="error">
            Please enter a valid Agency ID.
        </div>
        <div *ngIf="searchContactPersonName && searchContactPersonName.length === 0" class="error">
            Please enter a valid Contact Person Name.
        </div>
    </div>

    <!-- Add Agency Button -->
    <button class="add-agency-btn" (click)="isCreate()">Add Agency</button>

    <!-- Add Agency Form (Visible when isTrue is true) -->
    <div *ngIf="isTrue">
        <h2>Add New Agency</h2>
        <form (ngSubmit)="saveNewAgency()">
            <div>
                <label for="name">Name:</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    [(ngModel)]="newAgency.name" 
                    required 
                />
            </div>

            <div>
                <label for="contactPersonName">Contact Person Name:</label>
                <input 
                    type="text" 
                    id="contactPersonName" 
                    name="contactPersonName" 
                    [(ngModel)]="newAgency.contactPersonName" 
                    required 
                />
            </div>

            <div>
                <label for="email">Email:</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    [(ngModel)]="newAgency.email" 
                    required 
                />
            </div>

            <div>
                <label for="phone">Phone:</label>
                <input 
                    type="text" 
                    id="phone" 
                    name="phone" 
                    [(ngModel)]="newAgency.phone" 
                    required 
                />
            </div>

            <button type="submit" class="btn btn-success">Create Agency</button>
            <button type="button" class="btn btn-secondary" (click)="isTrue = false">Cancel</button>
        </form>
    </div>

    <!-- Agency Table -->
    <table class="agency-table">
        <thead>
            <tr>
                <th>Agency ID</th>
                <th>Name</th>
                <th>Contact Person Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th> 
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let adminagency of agency">
                <td>{{ adminagency.agencyId }}</td>
                <td>{{ adminagency.name }}</td>
                <td>{{ adminagency.contactPersonName }}</td>
                <td>{{ adminagency.email }}</td>
                <td>{{ adminagency.phone }}</td>
                <td>
                    <button class="btn btn-success" (click)="editAgencyDetails(adminagency)">Edit</button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Edit Agency Form -->
    <div *ngIf="showEditAgencyForm">
        <h2>Edit Agency</h2>
        <form (ngSubmit)="updateAgency(editAgency.agencyId, editAgency)">
            <div>
                <label for="name">Name:</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    [(ngModel)]="editAgency.name" 
                    required 
                />
            </div>

            <div>
                <label for="contactPersonName">Contact Person Name:</label>
                <input 
                    type="text" 
                    id="contactPersonName" 
                    name="contactPersonName" 
                    [(ngModel)]="editAgency.contactPersonName" 
                    required 
                />
            </div>

            <div>
                <label for="email">Email:</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    [(ngModel)]="editAgency.email" 
                    required 
                />
            </div>

            <div>
                <label for="phone">Phone:</label>
                <input 
                    type="text" 
                    id="phone" 
                    name="phone" 
                    [(ngModel)]="editAgency.phone" 
                    required 
                />
            </div>

            <button type="submit" class="btn btn-success">Update Agency</button>
            <button type="button" class="btn btn-secondary" (click)="showEditAgencyForm = false">Cancel</button>
        </form>
    </div>
</div>
</div>